const wordguess_queue = {}

const uniqueRandomWords = `fill
money
secretary
abounding
silky
abundant
rhythm
harm
mammoth
whimsical
crow
agreement
miss
turkey
grease
hope
scintillating
government
fragile
ragged
ethereal
enormous
tick
even
tongue
omniscient
attach
scared
muddled
sky
drag
literate
historical
piquant
ruddy
fire
trap
alluring
late
greasy
afterthought
chivalrous
tremendous
discussion
cars
passenger
handle
tie
sable
sand
futuristic
guarantee
kettle
sign
hurry
occur
stupid
tire
hateful
shut
sigh
near
attraction
somber
crib
tasty
precede
grape
robust
tiny
industry
wrap
skate
whip
acrid
trains
acidic
perpetual
milky
entertain
decay
infamous
jolly
trick
psychedelic
crime
innate
feeble
worthless
heartbreaking
picayune
extra-large
toothbrush
melted
pink
mountain
venomous
unequal
afraid
bawdy
dog
aftermath
ski
wreck
camera
ablaze
judicious
bare
grass
nut
flow
silent
plane
wealth
attractive
caption
complex
same
toys
toothpaste
frequent
dust
book
adhesive
chunky
madly
next
jar
imported
health
fortunate
cute
ubiquitous
label
respect
rural
ruin
rigid
face
careless
icy
suck
program
feigned
sweltering
radiate
furniture
sound
lock
woebegone
shoe
violet
salt
downtown
manage
outgoing
position
pour
screw
van
boundary
puzzled
like
mysterious
hurried
wide-eyed
observe
lonely
important
friends
real
false
wobble
welcome
garrulous
thumb
popcorn
farm
volatile
soup
nauseating
lick
announce
increase
hobbies
racial
north
thrill
cakes
advertisement
stew
electric
island
impolite
unpack
sack
noise
bee
detail
available
entertaining
flaky
scissors
frail
bashful
desert
quilt
greedy
report
foolish
icicle
bustling
furry
servant
heady
recognise
sweater
pickle
license
jam
overt
knotty
hat
system
laborer
trace
pest
absorbed
deer
offbeat
damage
gruesome
wax
well-to-do
boy
dynamic
lip
boast
aquatic
adorable
desire
representative
dress
glossy
homeless
cactus
cure
snow
merciful
mint
observation
gate
rain
ill-fated
underwear
letters
visit
telephone
unaccountable
irate
ad hoc
control
tap
outstanding
winter
sordid
rejoice
regular
fascinated
tested
rule
accurate
stereotyped
earth
bore
spiky
bushes
fence
oatmeal
tough
wiry
flippant
teeny
can
cover
educated
burst
visitor
tiresome
cake
clear
stupendous
float
juicy
untidy
excuse
writing
sisters
classy
chemical
light
bucket
awesome
sort
amount
doctor
decorous
juvenile
eight
knife
disappear
basketball
coordinated
shy
slow
common
guard
charge
ring
hate
used
gold
jog
slim
nondescript
development
ball
motionless
blush
makeshift
queue
payment
stamp
determined
lamp
competition
brass
nappy
eatable
vulgar
slippery
slope
terrible
political
alive
scarf
exotic
groovy
travel
monkey
lumpy
useless
change
rapid
street
notice
tearful
leg
price
suggestion
hose
donkey
plug
rhyme
wall
adaptable
illustrious
abortive
typical
cow
grandmother
soft
smoggy
oceanic
quack
weak
temporary
depressed
clam
pies
reward
phobic
retire
pigs
snobbish
certain
shock
obscene
clever
ice
closed
history
purring
dapper
instrument
degree
thankful
calculating
crown
three
amusing
exchange
punishment
pipe
fluttering
peck
dramatic
shade
sincere
stare
connection
precious
tank
handsome
calendar
picture
glamorous
receptive
cloistered
desk
heap
pancake
close
defiant
reflect
talented
immense
gray
knee
room
scream
appear
vacation
feeling
plant
person
lumber
zippy
bedroom
move
eggs
shoes
shiver
found
berry
incredible
wistful
bent
abaft
fancy
lively
division
changeable
kill
jealous
admit
finger
current
two
flashy
double
destruction
thank
self
fruit
tightfisted
plucky
tedious
adventurous
river
glass
needless
ajar
curtain
wave
pause
color
steady
brick
shrug
amused
skinny
selfish
hand
rightful
best
juggle
graceful
dinosaurs
line
grateful
follow
marked
pale
fold
tan
channel
magic
windy
salty
crowd
rail
paddle
territory
hospital
callous
known
meaty
aspiring
numberless
admire
alarm
exuberant
fierce
elegant
synonymous
female
loud
poor
tiger
tidy
languid
odd
attempt
sulky
badge
hydrant
place
flame
rub
existence
ambiguous
join
wacky
tray
grieving
front
brash
unsuitable
tangible
inquisitive
repulsive
cowardly
uninterested
free
cable
fantastic
squeamish
squeeze
ruthless
dusty
smelly
comb
unwieldy
pump
nation
marry
deranged
mix
gullible
things
bite-sized
flowery
undress
ants
addicted
secret
jellyfish
town
compete
brief
property
delightful
pinch
mind
rinse
cynical
handsomely
damp
type
ladybug
loss
run
button
shelter
soak
rambunctious
nerve
protest
courageous
royal
borrow
fairies
terrify
club
hospitable
linen
year
giants
whirl
half
majestic
pick
print
actually
cracker
governor
straw
throne
zebra
aromatic
simplistic
broad
seat
ambitious
friendly
cheer
drawer
grip
domineering
maid
ten
develop
clip
voice
woman
quirky
low
alcoholic
mindless
upbeat
scare
null
delay
keen
prevent
cellar
calculator
painstaking
sloppy
wing
curl
anxious
spark
sin
mean
tense
men
seashore
huge
cattle
avoid
glow
permissible
joke
replace
credit
joyous
loving
sad
bat
afford
puny
scold
draconian
swim
deadpan
imagine
neat
choke
bag
shallow
fit
amuse
sticks
flat
arch
redundant
clumsy
glove
fuzzy
mess up
notebook
turn
basin
voyage
holistic
sassy
burn
launch
employ
arrest
influence
previous
quicksand
station
pushy
honorable
invent
wholesale
home
waiting
thought
load
magnificent
head
sister
trashy
view
sticky
expand
combative
wink
base
super
hushed
vagabond
lopsided
cemetery
lush
unite
instruct
righteous
knot
astonishing
quill
uncovered
interrupt
moaning
refuse
conscious
amuck
mine
crazy
snakes
ritzy
roll
bruise
gamy
zesty
rampant
annoy
collar
edge
hysterical
guarded
need
hot
fresh
ink
victorious
bumpy
nippy
level
grouchy
abashed
match
nebulous
yummy
tricky
melodic
reason
fabulous
useful
didactic
zoo
ugly
gusty
tender
yak
pray
preserve
exultant
cave
dark
dinner
married
pollution
long
building
lethal
wide
parallel
illegal
exclusive
horn
gaze
cuddly
hard
charming
bouncy
complain
ordinary
deceive
coal
team
neighborly
grade
bed
chubby
paper
offer
bomb
multiply
coast
aloof
muddle
remove
stir
premium
unadvised
troubled
resolute
kittens
striped
incandescent
bad
connect
film
test
legal
note
truck
weigh
sugar
arithmetic
mice
toes
wander
rock
disastrous
hideous
stage
start
festive
macabre
axiomatic
well-off
superficial
waggish
dangerous
bikes
measure
road
eminent
describe
time
horse
bite
internal
pail
carve
thinkable
ahead
greet
sip
consist
splendid
wilderness
waste
ray
selection
burly
yoke
bear
provide
queen
sudden
authority
harass
inform
pedal
fog
slave
account
duck
watery
rebel
exercise
strong
thaw
improve
dizzy
thundering
boorish
profit
nine
spade
box
new
shave
unwritten
automatic
pointless
shaggy
unkempt
perfect
acceptable
meddle
mute
observant
imperfect
gentle
round
scary
funny
coherent
slimy
breakable
versed
throat
right
air
organic
pocket
bleach
peaceful
rate
wretched
heavy
analyze
rake
melt
supreme
impulse
command
deliver
aware
pretty
zephyr
bead
kick
hulking
upset
toy
field
public
top
boat
x-ray
productive
barbarous
liquid
strengthen
womanly
wiggly
tendency
small
extra-small
defective
beg
equable
placid
overjoyed
curly
lean
look
structure
jaded
creepy
intelligent
physical
tow
wealthy
nonchalant
ocean
humorous
confess
surprise
ship
obsolete
statuesque
erect
unsightly
warn
squash
tub
bitter
mountainous
cheap
malicious
rat
thick
trust
circle
erratic
cross
writer
push
preach
soggy
file
healthy
prose
inject
boil
injure
bang
squeal
cup`.toString().split('\n')

let championship = {}
let currentRound = {}

function createWordGuess(word) {
  if (typeof word !== 'string') {
    return null; // Handle invalid input
  }

  const wordArray = word.split('');
  const wordLength = wordArray.length;

  // Calculate the number of letters to be replaced with underscores (e.g., 30% of the word length)
  const underscoreCount = Math.ceil(wordLength * 0.2); // You can adjust the percentage as needed

  if (underscoreCount >= wordLength) {
    return word; // No need to replace all characters with underscores
  }

  // Create an array to store the positions of the characters to be replaced
  const positionsToReplace = [];

  while (positionsToReplace.length < underscoreCount) {
    const randomPosition = Math.floor(Math.random() * wordLength);
    if (!positionsToReplace.includes(randomPosition)) {
      positionsToReplace.push(randomPosition);
    }
  }

  // Replace characters with underscores at the selected positions
  for (const position of positionsToReplace) {
    wordArray[position] = '_';
  }

  return wordArray.join(' ');
}


const wordguess = (api, event) => {

  let word = uniqueRandomWords[Math.floor(Math.random() * uniqueRandomWords.length)]

  wordguess_queue[event.senderID] = word

  console.log(word)

  shuffledWord = createWordGuess(word)

  api.sendMessage(`Your word is : \n${shuffledWord}`, event.threadID, event.messageID)


}

const handle_wordguess = async (api, event) => {
  if (wordguess_queue[event.senderID]) {
    if (event.body.toLowerCase() == wordguess_queue[event.senderID].toLowerCase()) {
      delete wordguess_queue[event.senderID]
      api.sendMessage(`Correct!`, event.threadID, event.messageID)
    } else {
      let w = wordguess_queue[event.senderID]
      delete wordguess_queue[event.senderID]
      await api.sendMessage(`Wrong! The correct word would be ${w}`, event.threadID, event.messageID)


    }
  }
}


const wordguesschampionship = async (api, event) => {

  let roundNumber = event.body.split('wordguesschampionship')[1].trim();
  roundNumber = roundNumber == '' ? 3 : Number(roundNumber);
  roundNumber = roundNumber == null ? 3 : roundNumber;
  if (!championship[event.threadID]) {
    championship[event.threadID] = [];
    currentRound[event.threadID] = 1;


    for (let i = 0; i < roundNumber; i++) {
      let word = uniqueRandomWords[Math.floor(Math.random() * uniqueRandomWords.length)];
      championship[event.threadID].push(word);
    }
    console.log(championship)
    let shuffledWord = createWordGuess(championship[event.threadID][0]);
     api.sendMessage(`Starting a wordguess championship with ${roundNumber} rounds!\nRound ${currentRound[event.threadID]}:\nGuess the word: ${shuffledWord}`, event.threadID, event.messageID)


  }
  else{
    api.sendMessage(`Wordguess championship is already running!`, event.threadID, event.messageID);
  }


};
const finish = async (api, event, winner) => {
  const countObj = {};
  console.log(winner)
  winner = JSON.parse(winner)
  for (let i = 0; i < winner.length; i++) {
    if (countObj[winner[i]]) {
      countObj[winner[i]]++;
      console.log(countObj)
    }
    else {
      countObj[winner[i]] = 1;
    }
  }
  console.log(countObj)
  let msg = 'Here is the result:\n'
  let max = [0];
  let max_val = 0
  for (const [key, value] of Object.entries(countObj)) {
    console.log(key)
    let name = await api.getUserInfo(key);
    console.log(name)
    name = name[key].name;
    msg += `${name}: ${value}\n`
    if (value > max_val) {
      max = [key];
      max_val = value;
    }
    else if(value == max_val){
      max.push(key)
    }
  }

  winnerlist = []
  for (let i = 0; i < max.length; i++) {
    let win = await api.getUserInfo(max[i])
    win = win[max[i]].name
    winnerlist.push(win)
  }

  msg += `Winners: ${winnerlist.join(', ')}`
  api.sendMessage(msg, event.threadID, event.messageID);
}

const handleChampionship = async (api, event) => {
  if (Object.keys(championship).includes(event.threadID)) {
    if (event.body.toLowerCase() == championship[event.threadID][currentRound[event.threadID]-1]) {
      // Correct answer
      championship[event.threadID][currentRound[event.threadID]-1] = (event.senderID);
      currentRound[event.threadID] = currentRound[event.threadID] + 1;
      console.log(championship)
      console.log(currentRound)

      api.sendMessage(`Correct! `, event.threadID, event.messageID);
      if (currentRound[event.threadID] > championship[event.threadID].length) {
        // End of championship
        let winner = JSON.stringify(championship[event.threadID])
        
        finish(api, event, winner);

        delete championship[event.threadID];
        delete currentRound[event.threadID];
        
     
    }else{
        let shuffledWord = createWordGuess(championship[event.threadID][currentRound[event.threadID]-1]);
        api.sendMessage(`Round ${currentRound[event.threadID]}:\nGuess the word: ${shuffledWord}`, event.threadID, event.messageID);
    }
    } else {

      api.sendMessage('Incorrect, please try again.', event.threadID, event.messageID);

    }



  }
  }


module.exports = {
  wordguess: wordguess,
  handle_wordguess: handle_wordguess,
  wordguesschampionship: wordguesschampionship,
  handleChampionship: handleChampionship
}
